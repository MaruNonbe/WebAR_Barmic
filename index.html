<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>ARキャラクター - 起動優先版</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

  <style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; }
    /* ARビデオが背面に隠れないように強制表示 */
    #arjs-video {
      width: 100vw !important;
      height: 100vh !important;
      object-fit: cover !important;
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
    }
    #ui-container {
      position: fixed; bottom: calc(30px + env(safe-area-inset-bottom));
      left: 0; width: 100%; z-index: 9999;
      display: flex; justify-content: center; gap: 10px; pointer-events: none;
    }
    .btn {
      padding: 12px 18px; background: rgba(255, 255, 255, 0.9);
      border-radius: 10px; font-weight: bold; cursor: pointer;
      pointer-events: auto; border: none; font-size: 16px;
    }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">

<a-scene
  embedded
  vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;"
  renderer="logarithmicDepthBuffer: true; colorManagement: true;"
>
  <a-assets>
    <a-asset-item id="char-model" src="HandRaising.glb"></a-asset-item>
  </a-assets>

  <a-light type="ambient" intensity="1.2"></a-light>
  <a-light type="directional" position="1 4 2" intensity="0.8"></a-light>

  <a-camera rotation-reader></a-camera>

  <a-entity id="character"
            gltf-model="#char-model"
            position="0 0 -5"
            scale="1 1 1"
            animation-mixer="clip: *; loop: repeat;">
  </a-entity>
</a-scene>

<div id="ui-container">
  <button class="btn" onclick="location.reload()">再読み込み</button>
  <button class="btn" id="btn-bigger">拡大</button>
  <button class="btn" id="btn-rotate">回転</button>
</div>

<script>
  const char = document.querySelector('#character');
  let currentScale = 1.0;
  let currentRotation = 0;

  document.getElementById('btn-bigger').onclick = () => {
    currentScale *= 1.2;
    char.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
  };

  document.getElementById('btn-rotate').onclick = () => {
    currentRotation += 45;
    char.setAttribute('rotation', `0 ${currentRotation} 0`);
  };
</script>
</body>
</html>