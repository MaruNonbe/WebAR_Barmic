<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>ARキャラクター - HandRaising</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

  <style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; }
    #ui-container {
      position: fixed; bottom: 30px; left: 0; width: 100%; z-index: 9999;
      display: flex; justify-content: center; gap: 10px; pointer-events: none;
    }
    .btn {
      padding: 12px 20px; background: rgba(255,255,255,0.8); border-radius: 10px;
      font-weight: bold; cursor: pointer; pointer-events: auto; border: none; font-family: sans-serif;
    }
  </style>
</head>
<body>

<a-scene
  embedded
  vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; debugUIEnabled: false;"
  renderer="colorManagement: true; exposure: 1.2;"
>
  <a-assets>
    <a-asset-item id="char-model" src="HandRaising.glb"></a-asset-item>
  </a-assets>

  <a-light type="ambient" color="#FFF" intensity="1.2"></a-light>
  <a-light type="directional" position="1 4 2" intensity="0.8"></a-light>

  <a-camera rotation-reader></a-camera>

  <a-entity id="character"
            gltf-model="#char-model"
            position="0 0 -10"
            scale="1 1 1"
            rotation="0 0 0"
            animation-mixer="clip: *; loop: repeat; timeScale: 1">
  </a-entity>
</a-scene>

<div id="ui-container">
  <button class="btn" id="btn-bigger">拡大</button>
  <button class="btn" id="btn-smaller">縮小</button>
  <button class="btn" id="btn-rotate">回転</button>
</div>

<script>
  const char = document.querySelector('#character');
  let currentScale = 1.0;
  let currentRotation = 0;

  // 拡大ボタン
  document.getElementById('btn-bigger').onclick = () => {
    currentScale += 0.2;
    char.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
  };

  // 縮小ボタン
  document.getElementById('btn-smaller').onclick = () => {
    currentScale = Math.max(0.1, currentScale - 0.2);
    char.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
  };

  // 回転ボタン
  document.getElementById('btn-rotate').onclick = () => {
    currentRotation += 45;
    char.setAttribute('rotation', `0 ${currentRotation} 0`);
  };

  // 2本指でのピンチ操作も有効にする場合（追加）
  let initialDist = 0;
  window.addEventListener('touchstart', e => {
    if (e.touches.length === 2) {
      initialDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
    }
  }, {passive: false});

  window.addEventListener('touchmove', e => {
    if (e.touches.length === 2 && initialDist > 0) {
      const dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
      const diff = dist / initialDist;
      currentScale *= diff;
      currentScale = Math.max(0.01, currentScale);
      char.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
      initialDist = dist;
    }
  }, {passive: false});
</script>
</body>
</html>